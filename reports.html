<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reports & Insights - Personal Finance Tracker</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="container">
            <div class="flex-between" style="padding: 1rem 0;">
                <div style="display: flex; align-items: center; gap: 1rem;">
                    <i class="fas fa-wallet" style="color: white; font-size: 1.5rem;"></i>
                    <h1 style="color: white; font-size: 1.5rem; font-weight: 700; margin: 0;">Finance Tracker</h1>
                </div>
                <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                    <a href="index.html" class="nav-link"><i class="fas fa-home"></i> Dashboard</a>
                    <a href="transactions.html" class="nav-link"><i class="fas fa-exchange-alt"></i> Transactions</a>
                    <a href="budget.html" class="nav-link"><i class="fas fa-chart-pie"></i> Budget</a>
                    <a href="savings.html" class="nav-link"><i class="fas fa-piggy-bank"></i> Savings</a>
                    <a href="bills.html" class="nav-link"><i class="fas fa-file-invoice-dollar"></i> Bills</a>
                    <a href="networth.html" class="nav-link"><i class="fas fa-chart-line"></i> Net Worth</a>
                    <a href="reports.html" class="nav-link active"><i class="fas fa-chart-bar"></i> Reports</a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container">
        <!-- Page Header -->
        <div class="page-header flex-between">
            <div>
                <h2 class="page-title">Reports & Insights</h2>
                <p class="page-subtitle">Analyze your financial data and trends</p>
            </div>
            <div class="flex gap-2">
                <button onclick="exportAllData()" class="btn btn-outline">
                    <i class="fas fa-download"></i> Export All Data
                </button>
                <button onclick="clearAllData()" class="btn btn-danger">
                    <i class="fas fa-trash"></i> Clear Data
                </button>
            </div>
        </div>

        <!-- Financial Health Score -->
        <div class="card mb-4">
            <div class="card-header">
                <span><i class="fas fa-heart"></i> Financial Health Score</span>
            </div>
            <div style="text-align: center; padding: 2rem;">
                <div id="healthScore" style="font-size: 4rem; font-weight: 700; color: var(--primary-color);">-</div>
                <div id="healthRating" style="font-size: 1.25rem; font-weight: 600; margin-top: 0.5rem;"></div>
                <div id="healthSummary" class="text-muted" style="margin-top: 1rem; max-width: 600px; margin-left: auto; margin-right: auto;"></div>
            </div>
            <div class="grid grid-4" style="gap: 1rem; padding: 1.5rem; background: #f9fafb; border-radius: 0.5rem;">
                <div style="text-align: center;">
                    <div class="text-muted" style="font-size: 0.875rem; text-transform: uppercase; margin-bottom: 0.5rem;">Income/Expense Ratio</div>
                    <div id="incomeRatio" style="font-weight: 700; font-size: 1.25rem;">-</div>
                </div>
                <div style="text-align: center;">
                    <div class="text-muted" style="font-size: 0.875rem; text-transform: uppercase; margin-bottom: 0.5rem;">Savings Rate</div>
                    <div id="savingsRate" style="font-weight: 700; font-size: 1.25rem;">-</div>
                </div>
                <div style="text-align: center;">
                    <div class="text-muted" style="font-size: 0.875rem; text-transform: uppercase; margin-bottom: 0.5rem;">Budget Adherence</div>
                    <div id="budgetAdherence" style="font-weight: 700; font-size: 1.25rem;">-</div>
                </div>
                <div style="text-align: center;">
                    <div class="text-muted" style="font-size: 0.875rem; text-transform: uppercase; margin-bottom: 0.5rem;">Debt-to-Asset Ratio</div>
                    <div id="debtRatio" style="font-weight: 700; font-size: 1.25rem;">-</div>
                </div>
            </div>
        </div>

        <!-- Period Selection -->
        <div class="card mb-4">
            <div class="card-header">
                <span><i class="fas fa-calendar"></i> Report Period</span>
            </div>
            <div class="flex gap-2" style="padding: 1rem;">
                <button onclick="setReportPeriod('month')" class="btn btn-outline" id="btnMonth">This Month</button>
                <button onclick="setReportPeriod('quarter')" class="btn btn-outline" id="btnQuarter">This Quarter</button>
                <button onclick="setReportPeriod('year')" class="btn btn-outline" id="btnYear">This Year</button>
                <button onclick="setReportPeriod('all')" class="btn btn-outline" id="btnAll">All Time</button>
            </div>
        </div>

        <!-- Summary Statistics -->
        <div class="grid grid-4 mb-4">
            <div class="stat-card">
                <div class="stat-label">Total Income</div>
                <div class="stat-value text-success" id="reportIncome">$0.00</div>
                <div class="text-muted" style="font-size: 0.875rem;" id="reportPeriodLabel">This month</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Total Expenses</div>
                <div class="stat-value text-danger" id="reportExpenses">$0.00</div>
                <div class="text-muted" style="font-size: 0.875rem;">Same period</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Net Savings</div>
                <div class="stat-value" id="reportSavings">$0.00</div>
                <div class="text-muted" style="font-size: 0.875rem;">Income - Expenses</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Transactions</div>
                <div class="stat-value text-primary" id="reportTransactionCount">0</div>
                <div class="text-muted" style="font-size: 0.875rem;">Total entries</div>
            </div>
        </div>

        <!-- Year-over-Year Comparison -->
        <div class="card mb-4">
            <div class="card-header">
                <span><i class="fas fa-chart-line"></i> Year-over-Year Comparison</span>
            </div>
            <div class="chart-container">
                <canvas id="yoyChart"></canvas>
            </div>
        </div>

        <!-- Monthly Spending Trends -->
        <div class="card mb-4">
            <div class="card-header">
                <span><i class="fas fa-chart-area"></i> Monthly Spending Trends</span>
            </div>
            <div class="chart-container">
                <canvas id="trendsChart"></canvas>
            </div>
        </div>

        <!-- Top Categories -->
        <div class="grid grid-2 mb-4">
            <div class="card">
                <div class="card-header">
                    <span><i class="fas fa-arrow-up"></i> Top Expense Categories</span>
                </div>
                <div id="topCategories"></div>
            </div>

            <div class="card">
                <div class="card-header">
                    <span><i class="fas fa-calendar-check"></i> Best & Worst Months</span>
                </div>
                <div id="bestWorstMonths"></div>
            </div>
        </div>

        <!-- Detailed Statistics -->
        <div class="card mb-4">
            <div class="card-header">
                <span><i class="fas fa-table"></i> Detailed Statistics</span>
            </div>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Metric</th>
                            <th>Value</th>
                        </tr>
                    </thead>
                    <tbody id="statsTable">
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Insights & Recommendations -->
        <div class="card mb-4">
            <div class="card-header">
                <span><i class="fas fa-lightbulb"></i> Insights & Recommendations</span>
            </div>
            <div id="insights">
                <p class="text-muted" style="padding: 1rem;">Add more transactions to see personalized insights.</p>
            </div>
        </div>
    </div>

    <script src="js/common.js"></script>
    <script>
        let currentPeriod = 'month';
        let yoyChart = null;
        let trendsChart = null;

        function loadReportsPage() {
            calculateHealthScore();
            setReportPeriod('month');
        }

        function calculateHealthScore() {
            const currentMonth = getCurrentMonth();
            const currentYear = getCurrentYear();

            const income = getMonthlyIncome(currentMonth, currentYear);
            const expenses = getMonthlyExpenses(currentMonth, currentYear);
            const netWorth = calculateNetWorth();

            let score = 50; // Start at 50

            // Income/Expense Ratio (max 25 points)
            if (income > 0) {
                const ratio = income / (expenses || 1);
                if (ratio >= 2) score += 25;
                else if (ratio >= 1.5) score += 20;
                else if (ratio >= 1.2) score += 15;
                else if (ratio >= 1) score += 10;
                else score -= 10;

                document.getElementById('incomeRatio').textContent = ratio.toFixed(2) + 'x';
            }

            // Savings Rate (max 25 points)
            if (income > 0) {
                const savingsRate = ((income - expenses) / income) * 100;
                if (savingsRate >= 30) score += 25;
                else if (savingsRate >= 20) score += 20;
                else if (savingsRate >= 10) score += 15;
                else if (savingsRate >= 5) score += 10;

                document.getElementById('savingsRate').textContent = Math.max(0, savingsRate).toFixed(1) + '%';
            }

            // Budget Adherence (max 15 points)
            const budgets = getBudgets();
            if (Object.keys(budgets).length > 0) {
                let totalBudget = 0;
                let totalSpent = 0;
                Object.keys(budgets).forEach(category => {
                    totalBudget += budgets[category];
                    totalSpent += getCategorySpending(category, currentMonth, currentYear);
                });

                const adherence = totalBudget > 0 ? ((totalBudget - totalSpent) / totalBudget) * 100 : 0;
                if (adherence >= 20) score += 15;
                else if (adherence >= 10) score += 10;
                else if (adherence >= 0) score += 5;

                document.getElementById('budgetAdherence').textContent = Math.max(0, adherence).toFixed(1) + '%';
            } else {
                document.getElementById('budgetAdherence').textContent = 'N/A';
            }

            // Debt-to-Asset Ratio (max 10 points)
            const assets = getAssets();
            const liabilities = getLiabilities();
            const totalAssets = assets.reduce((sum, a) => sum + parseFloat(a.value || 0), 0);
            const totalLiabilities = liabilities.reduce((sum, l) => sum + parseFloat(l.amount || 0), 0);

            if (totalAssets > 0) {
                const debtRatio = (totalLiabilities / totalAssets) * 100;
                if (debtRatio <= 10) score += 10;
                else if (debtRatio <= 30) score += 7;
                else if (debtRatio <= 50) score += 5;

                document.getElementById('debtRatio').textContent = debtRatio.toFixed(1) + '%';
            } else {
                document.getElementById('debtRatio').textContent = 'N/A';
            }

            // Net Worth Bonus
            if (netWorth > 100000) score += 5;
            else if (netWorth > 50000) score += 3;
            else if (netWorth > 0) score += 1;

            // Cap score at 100
            score = Math.min(100, Math.max(0, score));

            // Display score
            document.getElementById('healthScore').textContent = score;

            let rating, summary, color;
            if (score >= 80) {
                rating = 'Excellent';
                summary = 'Your finances are in great shape! Keep up the excellent work managing your money.';
                color = 'var(--success-color)';
            } else if (score >= 60) {
                rating = 'Good';
                summary = 'You\'re doing well with your finances. A few improvements could take you to the next level.';
                color = '#10b981';
            } else if (score >= 40) {
                rating = 'Fair';
                summary = 'Your finances need some attention. Focus on increasing savings and reducing expenses.';
                color = 'var(--warning-color)';
            } else {
                rating = 'Needs Improvement';
                summary = 'Your finances need significant work. Consider creating a budget and tracking expenses more closely.';
                color = 'var(--danger-color)';
            }

            document.getElementById('healthScore').style.color = color;
            document.getElementById('healthRating').textContent = rating;
            document.getElementById('healthRating').style.color = color;
            document.getElementById('healthSummary').textContent = summary;
        }

        function setReportPeriod(period) {
            currentPeriod = period;

            // Update button states
            document.querySelectorAll('.btn-outline').forEach(btn => {
                btn.classList.remove('btn-primary');
                btn.classList.add('btn-outline');
            });

            const btnId = 'btn' + period.charAt(0).toUpperCase() + period.slice(1);
            const activeBtn = document.getElementById(btnId);
            if (activeBtn) {
                activeBtn.classList.remove('btn-outline');
                activeBtn.classList.add('btn-primary');
            }

            loadReportData();
        }

        function loadReportData() {
            const transactions = getTransactions();
            const today = new Date();
            let startDate;

            switch(currentPeriod) {
                case 'month':
                    startDate = new Date(today.getFullYear(), today.getMonth(), 1);
                    document.getElementById('reportPeriodLabel').textContent = 'This month';
                    break;
                case 'quarter':
                    const quarter = Math.floor(today.getMonth() / 3);
                    startDate = new Date(today.getFullYear(), quarter * 3, 1);
                    document.getElementById('reportPeriodLabel').textContent = 'This quarter';
                    break;
                case 'year':
                    startDate = new Date(today.getFullYear(), 0, 1);
                    document.getElementById('reportPeriodLabel').textContent = 'This year';
                    break;
                case 'all':
                    startDate = new Date(2000, 0, 1);
                    document.getElementById('reportPeriodLabel').textContent = 'All time';
                    break;
            }

            const filtered = transactions.filter(t => new Date(t.date) >= startDate);

            const income = filtered.filter(t => t.type === 'income').reduce((sum, t) => sum + parseFloat(t.amount), 0);
            const expenses = filtered.filter(t => t.type === 'expense').reduce((sum, t) => sum + parseFloat(t.amount), 0);

            document.getElementById('reportIncome').textContent = formatCurrency(income);
            document.getElementById('reportExpenses').textContent = formatCurrency(expenses);
            document.getElementById('reportSavings').textContent = formatCurrency(income - expenses);
            document.getElementById('reportTransactionCount').textContent = filtered.length;

            loadYOYChart();
            loadTrendsChart();
            loadTopCategories();
            loadBestWorstMonths();
            loadDetailedStats();
            loadInsights();
        }

        function loadYOYChart() {
            const ctx = document.getElementById('yoyChart').getContext('2d');
            const transactions = getTransactions();
            const currentYear = getCurrentYear();
            const lastYear = currentYear - 1;

            const months = [];
            const currentYearData = [];
            const lastYearData = [];

            for (let i = 0; i < 12; i++) {
                months.push(getMonthName(i).substring(0, 3));
                currentYearData.push(getMonthlyExpenses(i, currentYear));
                lastYearData.push(getMonthlyExpenses(i, lastYear));
            }

            if (yoyChart) {
                yoyChart.destroy();
            }

            yoyChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: months,
                    datasets: [
                        {
                            label: currentYear,
                            data: currentYearData,
                            borderColor: '#3b82f6',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            tension: 0.4,
                            fill: true
                        },
                        {
                            label: lastYear,
                            data: lastYearData,
                            borderColor: '#9ca3af',
                            backgroundColor: 'rgba(156, 163, 175, 0.1)',
                            tension: 0.4,
                            fill: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '$' + value.toLocaleString();
                                }
                            }
                        }
                    }
                }
            });
        }

        function loadTrendsChart() {
            const ctx = document.getElementById('trendsChart').getContext('2d');
            const currentYear = getCurrentYear();
            const currentMonth = getCurrentMonth();

            const months = [];
            const data = [];

            for (let i = 11; i >= 0; i--) {
                let month = currentMonth - i;
                let year = currentYear;

                if (month < 0) {
                    month += 12;
                    year -= 1;
                }

                months.push(getMonthName(month).substring(0, 3));
                data.push(getMonthlyExpenses(month, year));
            }

            if (trendsChart) {
                trendsChart.destroy();
            }

            trendsChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: months,
                    datasets: [{
                        label: 'Monthly Expenses',
                        data: data,
                        borderColor: '#ef4444',
                        backgroundColor: 'rgba(239, 68, 68, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '$' + value.toLocaleString();
                                }
                            }
                        }
                    }
                }
            });
        }

        function loadTopCategories() {
            const transactions = getTransactions();
            const expenses = transactions.filter(t => t.type === 'expense');

            const categoryTotals = {};
            expenses.forEach(t => {
                categoryTotals[t.category] = (categoryTotals[t.category] || 0) + parseFloat(t.amount);
            });

            const sorted = Object.entries(categoryTotals).sort((a, b) => b[1] - a[1]);
            const container = document.getElementById('topCategories');

            if (sorted.length === 0) {
                container.innerHTML = '<p class="text-muted" style="padding: 1rem;">No expense data available</p>';
                return;
            }

            const total = sorted.reduce((sum, [, amount]) => sum + amount, 0);

            container.innerHTML = sorted.slice(0, 5).map(([category, amount], index) => {
                const percentage = ((amount / total) * 100).toFixed(1);
                return `
                    <div style="padding: 1rem; border-bottom: 1px solid var(--border-color);">
                        <div class="flex-between mb-1">
                            <span style="font-weight: 600;">${index + 1}. ${category}</span>
                            <span style="font-weight: 700; color: var(--danger-color);">${formatCurrency(amount)}</span>
                        </div>
                        <div class="progress-bar" style="height: 0.5rem;">
                            <div class="progress-fill danger" style="width: ${percentage}%"></div>
                        </div>
                        <div class="text-muted" style="font-size: 0.875rem; margin-top: 0.25rem;">${percentage}% of total expenses</div>
                    </div>
                `;
            }).join('');
        }

        function loadBestWorstMonths() {
            const currentYear = getCurrentYear();
            const monthlyData = [];

            for (let i = 0; i < 12; i++) {
                const income = getMonthlyIncome(i, currentYear);
                const expenses = getMonthlyExpenses(i, currentYear);
                const net = income - expenses;

                if (income > 0 || expenses > 0) {
                    monthlyData.push({
                        month: getMonthName(i),
                        net: net,
                        income: income,
                        expenses: expenses
                    });
                }
            }

            const container = document.getElementById('bestWorstMonths');

            if (monthlyData.length === 0) {
                container.innerHTML = '<p class="text-muted" style="padding: 1rem;">No monthly data available</p>';
                return;
            }

            monthlyData.sort((a, b) => b.net - a.net);

            const best = monthlyData[0];
            const worst = monthlyData[monthlyData.length - 1];

            container.innerHTML = `
                <div style="padding: 1rem; background: #f0fdf4; border-radius: 0.5rem; margin-bottom: 1rem;">
                    <div style="font-weight: 600; color: var(--success-color); margin-bottom: 0.5rem;">
                        <i class="fas fa-trophy"></i> Best Month: ${best.month}
                    </div>
                    <div style="font-size: 1.25rem; font-weight: 700; color: var(--success-color);">
                        ${formatCurrency(best.net)} saved
                    </div>
                    <div class="text-muted" style="font-size: 0.875rem;">
                        Income: ${formatCurrency(best.income)} • Expenses: ${formatCurrency(best.expenses)}
                    </div>
                </div>
                <div style="padding: 1rem; background: #fef2f2; border-radius: 0.5rem;">
                    <div style="font-weight: 600; color: var(--danger-color); margin-bottom: 0.5rem;">
                        <i class="fas fa-exclamation-triangle"></i> Worst Month: ${worst.month}
                    </div>
                    <div style="font-size: 1.25rem; font-weight: 700; color: var(--danger-color);">
                        ${worst.net >= 0 ? formatCurrency(worst.net) + ' saved' : formatCurrency(Math.abs(worst.net)) + ' deficit'}
                    </div>
                    <div class="text-muted" style="font-size: 0.875rem;">
                        Income: ${formatCurrency(worst.income)} • Expenses: ${formatCurrency(worst.expenses)}
                    </div>
                </div>
            `;
        }

        function loadDetailedStats() {
            const transactions = getTransactions();
            const currentMonth = getCurrentMonth();
            const currentYear = getCurrentYear();

            const income = getMonthlyIncome(currentMonth, currentYear);
            const expenses = getMonthlyExpenses(currentMonth, currentYear);

            const incomeTransactions = transactions.filter(t => t.type === 'income');
            const expenseTransactions = transactions.filter(t => t.type === 'expense');

            const avgIncome = incomeTransactions.length > 0
                ? incomeTransactions.reduce((sum, t) => sum + parseFloat(t.amount), 0) / incomeTransactions.length
                : 0;

            const avgExpense = expenseTransactions.length > 0
                ? expenseTransactions.reduce((sum, t) => sum + parseFloat(t.amount), 0) / expenseTransactions.length
                : 0;

            const largestExpense = expenseTransactions.length > 0
                ? Math.max(...expenseTransactions.map(t => parseFloat(t.amount)))
                : 0;

            const stats = [
                ['Total Transactions', transactions.length],
                ['Total Income Transactions', incomeTransactions.length],
                ['Total Expense Transactions', expenseTransactions.length],
                ['Average Income per Transaction', formatCurrency(avgIncome)],
                ['Average Expense per Transaction', formatCurrency(avgExpense)],
                ['Largest Single Expense', formatCurrency(largestExpense)],
                ['Net Worth', formatCurrency(calculateNetWorth())],
                ['Monthly Savings Rate', income > 0 ? (((income - expenses) / income) * 100).toFixed(1) + '%' : 'N/A']
            ];

            const tbody = document.getElementById('statsTable');
            tbody.innerHTML = stats.map(([metric, value]) => `
                <tr>
                    <td style="font-weight: 600;">${metric}</td>
                    <td>${value}</td>
                </tr>
            `).join('');
        }

        function loadInsights() {
            const transactions = getTransactions();
            const container = document.getElementById('insights');

            if (transactions.length < 5) {
                return;
            }

            const insights = [];
            const currentMonth = getCurrentMonth();
            const currentYear = getCurrentYear();

            const income = getMonthlyIncome(currentMonth, currentYear);
            const expenses = getMonthlyExpenses(currentMonth, currentYear);

            // Spending insights
            if (income > 0 && expenses > income) {
                insights.push({
                    type: 'warning',
                    message: `You're spending more than you earn this month. Your expenses (${formatCurrency(expenses)}) exceed your income (${formatCurrency(income)}) by ${formatCurrency(expenses - income)}.`
                });
            }

            if (income > 0 && expenses < income * 0.5) {
                insights.push({
                    type: 'success',
                    message: `Excellent savings rate! You're saving ${(((income - expenses) / income) * 100).toFixed(1)}% of your income this month.`
                });
            }

            // Category insights
            const expensesByCategory = {};
            transactions.filter(t => t.type === 'expense').forEach(t => {
                const date = new Date(t.date);
                if (date.getMonth() === currentMonth && date.getFullYear() === currentYear) {
                    expensesByCategory[t.category] = (expensesByCategory[t.category] || 0) + parseFloat(t.amount);
                }
            });

            const topCategory = Object.entries(expensesByCategory).sort((a, b) => b[1] - a[1])[0];
            if (topCategory) {
                const [category, amount] = topCategory;
                const percentage = ((amount / expenses) * 100).toFixed(1);
                insights.push({
                    type: 'info',
                    message: `Your highest spending category is ${category} at ${formatCurrency(amount)} (${percentage}% of total expenses).`
                });
            }

            // Budget insights
            const budgets = getBudgets();
            const overBudgetCategories = [];
            Object.keys(budgets).forEach(category => {
                const spent = getCategorySpending(category, currentMonth, currentYear);
                if (spent > budgets[category]) {
                    overBudgetCategories.push({ category, spent, budget: budgets[category] });
                }
            });

            if (overBudgetCategories.length > 0) {
                insights.push({
                    type: 'warning',
                    message: `You're over budget in ${overBudgetCategories.length} categor${overBudgetCategories.length === 1 ? 'y' : 'ies'}: ${overBudgetCategories.map(c => c.category).join(', ')}.`
                });
            }

            // Display insights
            if (insights.length === 0) {
                container.innerHTML = '<p class="text-muted" style="padding: 1rem;">Your finances look good! No major concerns at this time.</p>';
                return;
            }

            container.innerHTML = insights.map(insight => `
                <div class="alert alert-${insight.type}" style="margin-bottom: 1rem;">
                    <i class="fas fa-${insight.type === 'success' ? 'check-circle' : insight.type === 'warning' ? 'exclamation-triangle' : 'info-circle'}"></i>
                    <div>${insight.message}</div>
                </div>
            `).join('');
        }

        function exportAllData() {
            const data = {
                transactions: getTransactions(),
                budgets: getBudgets(),
                goals: getGoals(),
                bills: getBills(),
                assets: getAssets(),
                liabilities: getLiabilities(),
                exportDate: new Date().toISOString()
            };

            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'finance-tracker-backup-' + new Date().toISOString().split('T')[0] + '.json';
            a.click();
            window.URL.revokeObjectURL(url);
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', () => {
            loadReportsPage();
        });
    </script>
</body>
</html>
