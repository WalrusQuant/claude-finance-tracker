<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Net Worth Tracker - Personal Finance Tracker</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="container">
            <div class="flex-between" style="padding: 1rem 0;">
                <div style="display: flex; align-items: center; gap: 1rem;">
                    <i class="fas fa-wallet" style="color: white; font-size: 1.5rem;"></i>
                    <h1 style="color: white; font-size: 1.5rem; font-weight: 700; margin: 0;">Finance Tracker</h1>
                </div>
                <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                    <a href="index.html" class="nav-link"><i class="fas fa-home"></i> Dashboard</a>
                    <a href="transactions.html" class="nav-link"><i class="fas fa-exchange-alt"></i> Transactions</a>
                    <a href="budget.html" class="nav-link"><i class="fas fa-chart-pie"></i> Budget</a>
                    <a href="savings.html" class="nav-link"><i class="fas fa-piggy-bank"></i> Savings</a>
                    <a href="bills.html" class="nav-link"><i class="fas fa-file-invoice-dollar"></i> Bills</a>
                    <a href="networth.html" class="nav-link active"><i class="fas fa-chart-line"></i> Net Worth</a>
                    <a href="reports.html" class="nav-link"><i class="fas fa-chart-bar"></i> Reports</a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container">
        <!-- Page Header -->
        <div class="page-header">
            <h2 class="page-title">Net Worth Tracker</h2>
            <p class="page-subtitle">Monitor your total assets and liabilities</p>
        </div>

        <!-- Net Worth Summary -->
        <div class="grid grid-3 mb-4">
            <div class="stat-card success">
                <div class="stat-label">Total Assets</div>
                <div class="stat-value text-success" id="totalAssets">$0.00</div>
                <div class="text-muted" style="font-size: 0.875rem;">What you own</div>
            </div>
            <div class="stat-card danger">
                <div class="stat-label">Total Liabilities</div>
                <div class="stat-value text-danger" id="totalLiabilities">$0.00</div>
                <div class="text-muted" style="font-size: 0.875rem;">What you owe</div>
            </div>
            <div class="stat-card" id="netWorthCard">
                <div class="stat-label">Net Worth</div>
                <div class="stat-value" id="netWorth">$0.00</div>
                <div class="text-muted" style="font-size: 0.875rem;">Assets - Liabilities</div>
            </div>
        </div>

        <!-- Assets Section -->
        <div class="card mb-4">
            <div class="card-header flex-between">
                <span><i class="fas fa-plus-circle"></i> Assets</span>
                <button onclick="showAddAssetModal()" class="btn btn-sm btn-success">
                    <i class="fas fa-plus"></i> Add Asset
                </button>
            </div>
            <div id="assetsList">
                <div class="empty-state">
                    <div class="empty-state-icon"><i class="fas fa-coins"></i></div>
                    <div class="empty-state-title">No assets tracked</div>
                    <p>Add your assets (cash, savings, investments, property, etc.)</p>
                </div>
            </div>
        </div>

        <!-- Liabilities Section -->
        <div class="card mb-4">
            <div class="card-header flex-between">
                <span><i class="fas fa-minus-circle"></i> Liabilities</span>
                <button onclick="showAddLiabilityModal()" class="btn btn-sm btn-danger">
                    <i class="fas fa-plus"></i> Add Liability
                </button>
            </div>
            <div id="liabilitiesList">
                <div class="empty-state">
                    <div class="empty-state-icon"><i class="fas fa-credit-card"></i></div>
                    <div class="empty-state-title">No liabilities tracked</div>
                    <p>Add your liabilities (loans, credit cards, mortgages, etc.)</p>
                </div>
            </div>
        </div>

        <!-- Asset Distribution Chart -->
        <div class="grid grid-2 mb-4">
            <div class="card">
                <div class="card-header">
                    <span><i class="fas fa-chart-pie"></i> Asset Distribution</span>
                </div>
                <div class="chart-container">
                    <canvas id="assetChart"></canvas>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <span><i class="fas fa-chart-pie"></i> Liability Distribution</span>
                </div>
                <div class="chart-container">
                    <canvas id="liabilityChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Debt Payoff Tracker -->
        <div class="card mb-4" id="debtPayoffSection" style="display: none;">
            <div class="card-header">
                <span><i class="fas fa-tasks"></i> Debt Payoff Progress</span>
            </div>
            <div id="debtPayoffList"></div>
        </div>
    </div>

    <!-- Add/Edit Asset Modal -->
    <div id="assetModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <span id="assetModalTitle">Add Asset</span>
            </div>
            <form id="assetForm" onsubmit="saveAsset(event)">
                <div class="form-group">
                    <label class="form-label">Asset Name *</label>
                    <input type="text" id="assetName" class="form-input" required placeholder="e.g., Checking Account, Car, House">
                </div>
                <div class="form-group">
                    <label class="form-label">Type *</label>
                    <select id="assetType" class="form-select" required>
                        <option value="Cash">Cash</option>
                        <option value="Checking">Checking Account</option>
                        <option value="Savings">Savings Account</option>
                        <option value="Investment">Investment Account</option>
                        <option value="Retirement">Retirement Account (401k, IRA)</option>
                        <option value="Property">Real Estate/Property</option>
                        <option value="Vehicle">Vehicle</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Current Value *</label>
                    <input type="number" id="assetValue" class="form-input" step="0.01" min="0" required placeholder="0.00">
                </div>
                <div class="form-group">
                    <label class="form-label">Description</label>
                    <textarea id="assetDescription" class="form-textarea" placeholder="Additional details..."></textarea>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeAssetModal()">Cancel</button>
                    <button type="submit" class="btn btn-success">
                        <i class="fas fa-save"></i> Save Asset
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add/Edit Liability Modal -->
    <div id="liabilityModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <span id="liabilityModalTitle">Add Liability</span>
            </div>
            <form id="liabilityForm" onsubmit="saveLiability(event)">
                <div class="form-group">
                    <label class="form-label">Liability Name *</label>
                    <input type="text" id="liabilityName" class="form-input" required placeholder="e.g., Student Loan, Credit Card">
                </div>
                <div class="form-group">
                    <label class="form-label">Type *</label>
                    <select id="liabilityType" class="form-select" required>
                        <option value="Credit Card">Credit Card</option>
                        <option value="Student Loan">Student Loan</option>
                        <option value="Car Loan">Car Loan</option>
                        <option value="Mortgage">Mortgage</option>
                        <option value="Personal Loan">Personal Loan</option>
                        <option value="Medical Debt">Medical Debt</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Current Balance *</label>
                    <input type="number" id="liabilityAmount" class="form-input" step="0.01" min="0" required placeholder="0.00">
                </div>
                <div class="form-group">
                    <label class="form-label">Interest Rate (%)</label>
                    <input type="number" id="liabilityRate" class="form-input" step="0.01" min="0" max="100" placeholder="0.00">
                </div>
                <div class="form-group">
                    <label class="form-label">Description</label>
                    <textarea id="liabilityDescription" class="form-textarea" placeholder="Additional details..."></textarea>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeLiabilityModal()">Cancel</button>
                    <button type="submit" class="btn btn-danger">
                        <i class="fas fa-save"></i> Save Liability
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script src="js/common.js"></script>
    <script>
        let editingAssetId = null;
        let editingLiabilityId = null;
        let assetChart = null;
        let liabilityChart = null;

        function loadNetWorthPage() {
            updateSummaryCards();
            loadAssets();
            loadLiabilities();
            loadAssetChart();
            loadLiabilityChart();
            loadDebtPayoff();
        }

        function updateSummaryCards() {
            const assets = getAssets();
            const liabilities = getLiabilities();

            const totalAssets = assets.reduce((sum, a) => sum + parseFloat(a.value || 0), 0);
            const totalLiabilities = liabilities.reduce((sum, l) => sum + parseFloat(l.amount || 0), 0);
            const netWorth = totalAssets - totalLiabilities;

            document.getElementById('totalAssets').textContent = formatCurrency(totalAssets);
            document.getElementById('totalLiabilities').textContent = formatCurrency(totalLiabilities);
            document.getElementById('netWorth').textContent = formatCurrency(netWorth);

            // Color code net worth
            const netWorthCard = document.getElementById('netWorthCard');
            const netWorthEl = document.getElementById('netWorth');

            if (netWorth > 0) {
                netWorthCard.classList.add('success');
                netWorthEl.classList.add('text-success');
            } else if (netWorth < 0) {
                netWorthCard.classList.add('danger');
                netWorthEl.classList.add('text-danger');
            }
        }

        function loadAssets() {
            const assets = getAssets();
            const container = document.getElementById('assetsList');

            if (assets.length === 0) {
                return; // Keep empty state
            }

            // Group by type
            const grouped = {};
            assets.forEach(asset => {
                if (!grouped[asset.type]) {
                    grouped[asset.type] = [];
                }
                grouped[asset.type].push(asset);
            });

            container.innerHTML = '';

            Object.keys(grouped).forEach(type => {
                const typeAssets = grouped[type];
                const typeTotal = typeAssets.reduce((sum, a) => sum + parseFloat(a.value), 0);

                const section = document.createElement('div');
                section.style.marginBottom = '1.5rem';
                section.innerHTML = `
                    <h4 style="font-weight: 600; color: var(--success-color); margin-bottom: 0.75rem;">
                        ${type} - ${formatCurrency(typeTotal)}
                    </h4>
                    ${typeAssets.map(asset => `
                        <div class="flex-between" style="padding: 0.75rem; background: #f0fdf4; border-radius: 0.5rem; margin-bottom: 0.5rem;">
                            <div>
                                <div style="font-weight: 600;">${asset.name}</div>
                                ${asset.description ? `<div class="text-muted" style="font-size: 0.875rem;">${asset.description}</div>` : ''}
                            </div>
                            <div style="text-align: right;">
                                <div style="font-weight: 700; color: var(--success-color); font-size: 1.125rem;">
                                    ${formatCurrency(asset.value)}
                                </div>
                                <div class="flex gap-1" style="margin-top: 0.25rem;">
                                    <button class="btn-icon" onclick="editAsset('${asset.id}')" title="Edit">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn-icon" onclick="deleteAssetConfirm('${asset.id}')" title="Delete">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                `;
                container.appendChild(section);
            });
        }

        function loadLiabilities() {
            const liabilities = getLiabilities();
            const container = document.getElementById('liabilitiesList');

            if (liabilities.length === 0) {
                return; // Keep empty state
            }

            // Group by type
            const grouped = {};
            liabilities.forEach(liability => {
                if (!grouped[liability.type]) {
                    grouped[liability.type] = [];
                }
                grouped[liability.type].push(liability);
            });

            container.innerHTML = '';

            Object.keys(grouped).forEach(type => {
                const typeLiabilities = grouped[type];
                const typeTotal = typeLiabilities.reduce((sum, l) => sum + parseFloat(l.amount), 0);

                const section = document.createElement('div');
                section.style.marginBottom = '1.5rem';
                section.innerHTML = `
                    <h4 style="font-weight: 600; color: var(--danger-color); margin-bottom: 0.75rem;">
                        ${type} - ${formatCurrency(typeTotal)}
                    </h4>
                    ${typeLiabilities.map(liability => `
                        <div class="flex-between" style="padding: 0.75rem; background: #fef2f2; border-radius: 0.5rem; margin-bottom: 0.5rem;">
                            <div>
                                <div style="font-weight: 600;">${liability.name}</div>
                                ${liability.interestRate ? `<div class="text-muted" style="font-size: 0.875rem;">Interest Rate: ${liability.interestRate}%</div>` : ''}
                                ${liability.description ? `<div class="text-muted" style="font-size: 0.875rem;">${liability.description}</div>` : ''}
                            </div>
                            <div style="text-align: right;">
                                <div style="font-weight: 700; color: var(--danger-color); font-size: 1.125rem;">
                                    ${formatCurrency(liability.amount)}
                                </div>
                                <div class="flex gap-1" style="margin-top: 0.25rem;">
                                    <button class="btn-icon" onclick="editLiability('${liability.id}')" title="Edit">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn-icon" onclick="deleteLiabilityConfirm('${liability.id}')" title="Delete">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                `;
                container.appendChild(section);
            });
        }

        function loadAssetChart() {
            const ctx = document.getElementById('assetChart').getContext('2d');
            const assets = getAssets();

            // Group by type
            const typeValues = {};
            assets.forEach(asset => {
                typeValues[asset.type] = (typeValues[asset.type] || 0) + parseFloat(asset.value);
            });

            const labels = Object.keys(typeValues);
            const data = Object.values(typeValues);

            if (assetChart) {
                assetChart.destroy();
            }

            if (labels.length === 0) {
                ctx.canvas.parentElement.innerHTML = '<div class="empty-state"><div class="empty-state-icon"><i class="fas fa-chart-pie"></i></div><div class="empty-state-title">No asset data</div></div>';
                return;
            }

            assetChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: [
                            '#10b981', '#059669', '#34d399', '#6ee7b7',
                            '#a7f3d0', '#d1fae5', '#10b981', '#047857'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'bottom'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const value = formatCurrency(context.parsed);
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = ((context.parsed / total) * 100).toFixed(1);
                                    return `${context.label}: ${value} (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }

        function loadLiabilityChart() {
            const ctx = document.getElementById('liabilityChart').getContext('2d');
            const liabilities = getLiabilities();

            // Group by type
            const typeValues = {};
            liabilities.forEach(liability => {
                typeValues[liability.type] = (typeValues[liability.type] || 0) + parseFloat(liability.amount);
            });

            const labels = Object.keys(typeValues);
            const data = Object.values(typeValues);

            if (liabilityChart) {
                liabilityChart.destroy();
            }

            if (labels.length === 0) {
                ctx.canvas.parentElement.innerHTML = '<div class="empty-state"><div class="empty-state-icon"><i class="fas fa-chart-pie"></i></div><div class="empty-state-title">No liability data</div></div>';
                return;
            }

            liabilityChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: [
                            '#ef4444', '#dc2626', '#f87171', '#fca5a5',
                            '#fecaca', '#fee2e2', '#ef4444', '#b91c1c'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'bottom'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const value = formatCurrency(context.parsed);
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = ((context.parsed / total) * 100).toFixed(1);
                                    return `${context.label}: ${value} (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }

        function loadDebtPayoff() {
            const liabilities = getLiabilities();
            const section = document.getElementById('debtPayoffSection');
            const container = document.getElementById('debtPayoffList');

            if (liabilities.length === 0) {
                section.style.display = 'none';
                return;
            }

            section.style.display = 'block';
            container.innerHTML = '';

            // Assume initial debt was 20% higher (for demonstration)
            liabilities.forEach(liability => {
                const initialDebt = parseFloat(liability.amount) * 1.2;
                const currentDebt = parseFloat(liability.amount);
                const paidOff = initialDebt - currentDebt;
                const progress = ((paidOff / initialDebt) * 100).toFixed(1);

                const item = document.createElement('div');
                item.style.marginBottom = '1.5rem';
                item.innerHTML = `
                    <div class="flex-between mb-1">
                        <span style="font-weight: 600;">${liability.name}</span>
                        <span class="text-muted">
                            Paid: ${formatCurrency(paidOff)} / ${formatCurrency(initialDebt)}
                        </span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${progress}%">
                            ${progress > 15 ? progress + '%' : ''}
                        </div>
                    </div>
                    <div class="text-muted" style="font-size: 0.875rem; margin-top: 0.5rem;">
                        Remaining: ${formatCurrency(currentDebt)}
                    </div>
                `;
                container.appendChild(item);
            });
        }

        // Asset Functions
        function showAddAssetModal() {
            editingAssetId = null;
            document.getElementById('assetModalTitle').textContent = 'Add Asset';
            document.getElementById('assetForm').reset();
            document.getElementById('assetModal').classList.add('active');
        }

        function closeAssetModal() {
            document.getElementById('assetModal').classList.remove('active');
        }

        function saveAsset(event) {
            event.preventDefault();

            const asset = {
                name: document.getElementById('assetName').value,
                type: document.getElementById('assetType').value,
                value: parseFloat(document.getElementById('assetValue').value),
                description: document.getElementById('assetDescription').value
            };

            if (editingAssetId) {
                updateAsset(editingAssetId, asset);
            } else {
                addAsset(asset);
            }

            closeAssetModal();
            loadNetWorthPage();
        }

        function editAsset(id) {
            const assets = getAssets();
            const asset = assets.find(a => a.id === id);

            if (!asset) return;

            editingAssetId = id;
            document.getElementById('assetModalTitle').textContent = 'Edit Asset';
            document.getElementById('assetName').value = asset.name;
            document.getElementById('assetType').value = asset.type;
            document.getElementById('assetValue').value = asset.value;
            document.getElementById('assetDescription').value = asset.description || '';

            document.getElementById('assetModal').classList.add('active');
        }

        function deleteAssetConfirm(id) {
            if (confirm('Are you sure you want to delete this asset?')) {
                deleteAsset(id);
                loadNetWorthPage();
            }
        }

        // Liability Functions
        function showAddLiabilityModal() {
            editingLiabilityId = null;
            document.getElementById('liabilityModalTitle').textContent = 'Add Liability';
            document.getElementById('liabilityForm').reset();
            document.getElementById('liabilityModal').classList.add('active');
        }

        function closeLiabilityModal() {
            document.getElementById('liabilityModal').classList.remove('active');
        }

        function saveLiability(event) {
            event.preventDefault();

            const liability = {
                name: document.getElementById('liabilityName').value,
                type: document.getElementById('liabilityType').value,
                amount: parseFloat(document.getElementById('liabilityAmount').value),
                interestRate: parseFloat(document.getElementById('liabilityRate').value) || 0,
                description: document.getElementById('liabilityDescription').value
            };

            if (editingLiabilityId) {
                updateLiability(editingLiabilityId, liability);
            } else {
                addLiability(liability);
            }

            closeLiabilityModal();
            loadNetWorthPage();
        }

        function editLiability(id) {
            const liabilities = getLiabilities();
            const liability = liabilities.find(l => l.id === id);

            if (!liability) return;

            editingLiabilityId = id;
            document.getElementById('liabilityModalTitle').textContent = 'Edit Liability';
            document.getElementById('liabilityName').value = liability.name;
            document.getElementById('liabilityType').value = liability.type;
            document.getElementById('liabilityAmount').value = liability.amount;
            document.getElementById('liabilityRate').value = liability.interestRate || '';
            document.getElementById('liabilityDescription').value = liability.description || '';

            document.getElementById('liabilityModal').classList.add('active');
        }

        function deleteLiabilityConfirm(id) {
            if (confirm('Are you sure you want to delete this liability?')) {
                deleteLiability(id);
                loadNetWorthPage();
            }
        }

        // Close modals when clicking outside
        document.getElementById('assetModal').addEventListener('click', function(e) {
            if (e.target === this) closeAssetModal();
        });

        document.getElementById('liabilityModal').addEventListener('click', function(e) {
            if (e.target === this) closeLiabilityModal();
        });

        // Initialize page
        document.addEventListener('DOMContentLoaded', () => {
            loadNetWorthPage();
        });
    </script>
</body>
</html>
